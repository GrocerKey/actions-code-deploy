name: 'actions-code-deploy'
inputs:
  application-name:
    required: true
  output-directory:
    required: true
  s3-bucket:
    required: true
  environment:
    required: true
runs:
  using: "composite"
  steps:
      - run: ((Get-Content -path ${{github.workspace}}\bin\deployment\deployment.bat)) -replace 'development', '${{inputs.environment}}' | Set-Content -Path ${{github.workspace}}\bin\deployment\deployment.bat
        shell: powershell
      - run: aws deploy push --region us-east-1 --debug --application-name  ${{inputs.application-name}} --s3-location s3://${{inputs.s3-bucket}}/${{inputs.application-name}}.zip --source ${{inputs.output-directory}} --ignore-hidden-files
        shell: powershell       
      - run: aws deploy create-deployment --region us-east-1 --debug --application-name ${{inputs.application-name}} --s3-location bucket=${{inputs.s3-bucket}},key=${{inputs.application-name}}.zip,bundleType=zip --deployment-group-name ${{inputs.application-name}} --deployment-config-name CodeDeployDefault.HalfAtATime
        shell: powershell
